<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸœ å’±åƒå•¥ - AI æ™ºèƒ½æ¨è</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .animate-spin {
      animation: spin 1s linear infinite;
    }
  </style>
</head>
<body class="bg-gray-50">
  <!-- å¯¼èˆªæ  -->
  <nav class="bg-white/80 backdrop-blur-md border-b border-gray-100 sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <span class="text-2xl">ğŸœ</span>
        <span class="font-bold text-gray-800 text-lg">å’±åƒå•¥</span>
      </div>
      <button id="loginBtn" class="px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg text-sm font-medium shadow-md hover:shadow-lg transition-all">
        SecondMe ç™»å½•
      </button>
      <button id="logoutBtn" class="hidden px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm hover:bg-gray-200 transition-colors">
        é€€å‡ºç™»å½•
      </button>
    </div>
  </nav>

  <!-- ç™»å½•å‰é¡µé¢ -->
  <div id="landingPage" class="max-w-4xl mx-auto px-4 py-16 text-center">
    <div class="text-8xl mb-6">ğŸœğŸ¤”ğŸ±</div>
    <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-6">
      ä»Šå¤©åƒå•¥ï¼Ÿ
      <br>
      <span class="text-orange-500">AI æ¥å¸®ä½ å†³å®š</span>
    </h1>
    <p class="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">
      å’Œå¥½å‹èšé¤æ€»æ˜¯ä¼—å£éš¾è°ƒï¼Ÿä¸Šä¼ ä½ ä»¬å–œæ¬¢çš„èœå“ï¼Œ
      AI æ™ºèƒ½åˆ†æç¾¤ä½“å£å‘³ï¼Œæ¨èæœ€åˆé€‚çš„é¤å…
    </p>
    <button id="startBtn" class="px-8 py-4 bg-orange-500 hover:bg-orange-600 text-white text-lg font-medium rounded-xl shadow-lg hover:shadow-xl transition-all">
      å¼€å§‹ä½¿ç”¨
    </button>

    <!-- åŠŸèƒ½ä»‹ç» -->
    <div class="grid md:grid-cols-3 gap-8 mt-16">
      <div class="bg-white rounded-2xl p-6 shadow-sm">
        <div class="text-4xl mb-4">ğŸ“</div>
        <h3 class="text-lg font-bold text-gray-800 mb-2">1. è¾“å…¥èœå“</h3>
        <p class="text-gray-600 text-sm">æ¯äººä¸Šä¼ è‡ªå·±å–œæ¬¢çš„èœå“ï¼Œæ¯è¡Œä¸€é“</p>
      </div>
      <div class="bg-white rounded-2xl p-6 shadow-sm">
        <div class="text-4xl mb-4">ğŸ¤–</div>
        <h3 class="text-lg font-bold text-gray-800 mb-2">2. AI åˆ†æ</h3>
        <p class="text-gray-600 text-sm">SecondMe AI è‡ªåŠ¨åˆ†æå£å‘³ç”»åƒ</p>
      </div>
      <div class="bg-white rounded-2xl p-6 shadow-sm">
        <div class="text-4xl mb-4">ğŸ¯</div>
        <h3 class="text-lg font-bold text-gray-800 mb-2">3. è·å–æ¨è</h3>
        <p class="text-gray-600 text-sm">æ™ºèƒ½åŒ¹é…ç¾¤ä½“å£å‘³ï¼Œæ¨èé¤å…</p>
      </div>
    </div>
  </div>

  <!-- ä¸»åº”ç”¨é¡µé¢ -->
  <div id="appPage" class="hidden max-w-6xl mx-auto px-4 py-8">
    <!-- æ­¥éª¤æŒ‡ç¤º -->
    <div class="flex justify-center gap-8 mb-8 text-sm text-gray-500">
      <div class="flex items-center gap-2">
        <span class="w-6 h-6 bg-orange-500 text-white rounded-full flex items-center justify-center text-xs font-medium">1</span>
        è¾“å…¥å–œæ¬¢çš„èœå“
      </div>
      <div class="flex items-center gap-2">
        <span class="w-6 h-6 bg-orange-500 text-white rounded-full flex items-center justify-center text-xs font-medium">2</span>
        AI åˆ†æå£å‘³ç”»åƒ
      </div>
      <div class="flex items-center gap-2">
        <span class="w-6 h-6 bg-orange-500 text-white rounded-full flex items-center justify-center text-xs font-medium">3</span>
        è·å–ç¾¤ä½“æ¨è
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- å·¦ä¾§ï¼šç”¨æˆ·è¾“å…¥åŒº -->
      <div class="lg:col-span-2 space-y-4">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-medium text-gray-800">å‚ä¸ç”¨æˆ· (<span id="userCount">1</span>)</h2>
          <button id="addUserBtn" class="flex items-center gap-1 px-3 py-1.5 text-sm text-orange-600 hover:bg-orange-50 rounded-lg transition-colors">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            æ·»åŠ å¥½å‹
          </button>
        </div>
        <div id="userCards" class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- ç”¨æˆ·å¡ç‰‡ä¼šåŠ¨æ€æ’å…¥è¿™é‡Œ -->
        </div>
        
        <!-- ç¤ºä¾‹æ•°æ®æŒ‰é’® -->
        <div class="mt-6 text-center">
          <button id="loadDemoBtn" class="text-sm text-gray-500 hover:text-orange-600 underline">
            åŠ è½½ç¤ºä¾‹æ•°æ®ï¼ˆæ¼”ç¤ºç”¨ï¼‰
          </button>
        </div>
      </div>

      <!-- å³ä¾§ï¼šç¾¤ä½“ç»“æœ -->
      <div class="lg:col-span-1">
        <div class="sticky top-24" id="groupResult">
          <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 text-center">
            <div class="text-4xl mb-3">ğŸ‘¥</div>
            <h3 class="text-lg font-medium text-gray-800 mb-1">ç­‰å¾…æ›´å¤šç”¨æˆ·</h3>
            <p class="text-sm text-gray-500">è‡³å°‘éœ€è¦ 2 ä½ç”¨æˆ·å®Œæˆ AI åˆ†æ</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ============ çŠ¶æ€ç®¡ç† ============
    let users = [{ id: '1', name: 'æˆ‘', dishes: '', profile: null }];
    let isLoggedIn = false;
    let userCounter = 1;

    // ============ DOM å…ƒç´  ============
    const landingPage = document.getElementById('landingPage');
    const appPage = document.getElementById('appPage');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const startBtn = document.getElementById('startBtn');
    const userCards = document.getElementById('userCards');
    const userCount = document.getElementById('userCount');
    const addUserBtn = document.getElementById('addUserBtn');
    const loadDemoBtn = document.getElementById('loadDemoBtn');
    const groupResult = document.getElementById('groupResult');

    // ============ äº‹ä»¶ç›‘å¬ ============
    loginBtn.addEventListener('click', () => {
      isLoggedIn = true;
      loginBtn.classList.add('hidden');
      logoutBtn.classList.remove('hidden');
      alert('ç™»å½•æˆåŠŸï¼ï¼ˆæ¼”ç¤ºæ¨¡å¼ï¼‰');
    });

    logoutBtn.addEventListener('click', () => {
      isLoggedIn = false;
      loginBtn.classList.remove('hidden');
      logoutBtn.classList.add('hidden');
      showLanding();
    });

    startBtn.addEventListener('click', () => {
      if (!isLoggedIn) {
        alert('è¯·å…ˆç™»å½•åå†ä½¿ç”¨ï¼');
        return;
      }
      showApp();
    });

    addUserBtn.addEventListener('click', addUser);
    loadDemoBtn.addEventListener('click', loadDemoData);

    // ============ é¡µé¢åˆ‡æ¢ ============
    function showLanding() {
      landingPage.classList.remove('hidden');
      appPage.classList.add('hidden');
    }

    function showApp() {
      landingPage.classList.add('hidden');
      appPage.classList.remove('hidden');
      renderUserCards();
    }

    // ============ ç”¨æˆ·å¡ç‰‡æ¸²æŸ“ ============
    function renderUserCards() {
      userCards.innerHTML = '';
      userCount.textContent = users.length;
      
      users.forEach(user => {
        const card = createUserCard(user);
        userCards.appendChild(card);
      });
      
      updateGroupResult();
    }

    function createUserCard(user) {
      const div = document.createElement('div');
      div.className = 'bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden';
      
      if (!user.profile) {
        // è¾“å…¥æ¨¡å¼
        div.innerHTML = `
          <div class="px-4 py-3 bg-gradient-to-r from-orange-50 to-amber-50 border-b border-gray-100 flex items-center justify-between">
            <input type="text" value="${user.name}" 
              class="bg-transparent font-medium text-gray-800 focus:outline-none focus:ring-2 focus:ring-orange-300 rounded px-1"
              onchange="updateUserName('${user.id}', this.value)">
            ${users.length > 1 ? `<button onclick="removeUser('${user.id}')" class="text-gray-400 hover:text-red-500">âœ•</button>` : ''}
          </div>
          <div class="p-4">
            <textarea 
              class="w-full h-40 p-3 text-sm border border-gray-200 rounded-lg focus:ring-2 focus:ring-orange-500 resize-none"
              placeholder="è¾“å…¥ä½ å–œæ¬¢çš„èœå“ï¼Œæ¯è¡Œä¸€é“ï¼š\nå®«ä¿é¸¡ä¸\néº»å©†è±†è…\næ°´ç…®é±¼\n..."
              onchange="updateUserDishes('${user.id}', this.value)"
            >${user.dishes}</textarea>
            <div class="mt-3 flex items-center justify-between">
              <span class="text-xs text-gray-500">${user.dishes.split('\n').filter(d => d.trim()).length} é“èœ</span>
              <button onclick="analyzeUser('${user.id}')" 
                class="px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg text-sm font-medium shadow-md">
                AI åˆ†æ
              </button>
            </div>
          </div>
        `;
      } else {
        // ç»“æœå±•ç¤ºæ¨¡å¼
        const p = user.profile;
        div.innerHTML = `
          <div class="px-4 py-3 bg-gradient-to-r from-orange-50 to-amber-50 border-b border-gray-100">
            <span class="font-medium text-gray-800">${user.name}</span>
          </div>
          <div class="p-4 space-y-4">
            ${createRadarSvg(p.taste_profile)}
            <div class="space-y-2">
              ${createTasteBar('è¾£', p.taste_profile.spicy, '#ef4444')}
              ${createTasteBar('éº»', p.taste_profile.numbing, '#a855f7')}
              ${createTasteBar('ç”œ', p.taste_profile.sweet, '#f97316')}
              ${createTasteBar('å’¸', p.taste_profile.salty, '#3b82f6')}
            </div>
            <div class="pt-3 border-t border-gray-100">
              <p class="text-xs text-gray-500 mb-2">åå¥½èœç³»</p>
              <div class="flex flex-wrap gap-2">
                ${p.preferred_cuisines.map(c => `
                  <span class="px-2 py-1 bg-orange-100 text-orange-700 text-xs rounded-full">
                    ${c.name} ${(c.weight * 100).toFixed(0)}%
                  </span>
                `).join('')}
              </div>
            </div>
            <button onclick="resetUser('${user.id}')" 
              class="w-full py-2 text-sm text-gray-500 hover:text-orange-600 border-t border-gray-100 pt-3">
              é‡æ–°ç¼–è¾‘
            </button>
          </div>
        `;
      }
      
      return div;
    }

    // ============ é›·è¾¾å›¾ ============
    function createRadarSvg(taste) {
      const size = 120;
      const center = size / 2;
      const radius = size * 0.35;
      const labels = ['è¾£', 'ç”œ', 'å’¸', 'é…¸', 'éº»'];
      const values = [taste.spicy, taste.sweet, taste.salty, taste.sour, taste.numbing];
      
      const getPoint = (i, val) => {
        const angle = (Math.PI * 2 * i) / 5 - Math.PI / 2;
        const r = val * radius;
        return { x: center + r * Math.cos(angle), y: center + r * Math.sin(angle) };
      };
      
      const points = values.map((v, i) => getPoint(i, v));
      const pathD = points.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`).join(' ') + ' Z';
      
      const gridPoints = [0.2, 0.4, 0.6, 0.8, 1].map(scale => 
        labels.map((_, i) => {
          const p = getPoint(i, scale);
          return `${p.x},${p.y}`;
        }).join(' ')
      );
      
      const axisLines = labels.map((_, i) => {
        const p = getPoint(i, 1);
        return `<line x1="${center}" y1="${center}" x2="${p.x}" y2="${p.y}" stroke="#e5e7eb" stroke-width="1"/>`;
      }).join('');
      
      const labelTexts = labels.map((label, i) => {
        const p = getPoint(i, 1.2);
        return `<text x="${p.x}" y="${p.y}" text-anchor="middle" font-size="10" fill="#6b7280">${label}</text>`;
      }).join('');
      
      return `
        <svg width="${size}" height="${size}" class="mx-auto">
          ${gridPoints.map(p => `<polygon points="${p}" fill="none" stroke="#e5e7eb" stroke-width="1"/>`).join('')}
          ${axisLines}
          <path d="${pathD}" fill="rgba(249, 115, 22, 0.3)" stroke="#f97316" stroke-width="2"/>
          ${labelTexts}
        </svg>
      `;
    }

    function createTasteBar(label, value, color) {
      return `
        <div class="flex items-center gap-2 text-sm">
          <span class="w-8 text-gray-600">${label}</span>
          <div class="flex-1 h-2 bg-gray-200 rounded-full overflow-hidden">
            <div class="h-full rounded-full transition-all duration-500" 
              style="width: ${value * 100}%; background-color: ${color}"></div>
          </div>
          <span class="w-10 text-right text-gray-500">${(value * 100).toFixed(0)}%</span>
        </div>
      `;
    }

    // ============ ç”¨æˆ·æ“ä½œ ============
    function addUser() {
      userCounter++;
      users.push({ 
        id: String(userCounter), 
        name: `å¥½å‹ ${userCounter}`, 
        dishes: '', 
        profile: null 
      });
      renderUserCards();
    }

    function removeUser(id) {
      users = users.filter(u => u.id !== id);
      renderUserCards();
    }

    function updateUserName(id, name) {
      const user = users.find(u => u.id === id);
      if (user) user.name = name;
    }

    function updateUserDishes(id, dishes) {
      const user = users.find(u => u.id === id);
      if (user) user.dishes = dishes;
    }

    function resetUser(id) {
      const user = users.find(u => u.id === id);
      if (user) user.profile = null;
      renderUserCards();
    }

    // ============ AI åˆ†æï¼ˆMockï¼‰ ============
    async function analyzeUser(id) {
      const user = users.find(u => u.id === id);
      if (!user || !user.dishes.trim()) {
        alert('è¯·å…ˆè¾“å…¥èœå“ï¼');
        return;
      }

      const btn = event.target;
      btn.innerHTML = '<span class="flex items-center gap-2"><svg class="animate-spin h-4 w-4" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"/><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/></svg>AI åˆ†æä¸­...</span>';
      btn.disabled = true;

      // æ¨¡æ‹Ÿ API å»¶è¿Ÿ
      await new Promise(r => setTimeout(r, 1500));

      const dishes = user.dishes.split('\n').filter(d => d.trim());
      const hasSichuan = dishes.some(d => /å®«ä¿|å®«çˆ†|éº»å©†|æ°´ç…®|è¾£å­|å›é”…/.test(d));
      const hasJapanese = dishes.some(d => /å¯¿å¸|åˆºèº«|æ‹‰é¢|å¤©å¦‡ç½—/.test(d));
      
      const mainCuisine = hasSichuan ? 'å·èœ' : hasJapanese ? 'æ—¥æ–™' : 'å®¶å¸¸èœ';
      
      user.profile = {
        preferred_cuisines: [{ name: mainCuisine, weight: 0.8 }, { name: 'å®¶å¸¸èœ', weight: 0.2 }],
        taste_profile: {
          spicy: hasSichuan ? 0.8 : 0.2,
          sweet: 0.3,
          salty: 0.5,
          sour: hasSichuan ? 0.3 : 0.2,
          numbing: hasSichuan ? 0.6 : 0.1,
        },
        normalized_dishes: dishes.map(d => ({
          original: d,
          standard: d.replace('å®«çˆ†', 'å®«ä¿'),
          cuisine: mainCuisine,
          aliases: d.includes('å®«çˆ†') ? ['å®«ä¿é¸¡ä¸'] : []
        }))
      };

      renderUserCards();
    }

    // ============ ç¾¤ä½“åŒ¹é… ============
    function updateGroupResult() {
      const analyzed = users.filter(u => u.profile);
      
      if (analyzed.length < 2) {
        groupResult.innerHTML = `
          <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 text-center">
            <div class="text-4xl mb-3">ğŸ‘¥</div>
            <h3 class="text-lg font-medium text-gray-800 mb-1">ç­‰å¾…æ›´å¤šç”¨æˆ·</h3>
            <p class="text-sm text-gray-500">è‡³å°‘éœ€è¦ 2 ä½ç”¨æˆ·å®Œæˆ AI åˆ†æ</p>
          </div>
        `;
        return;
      }

      // è®¡ç®—å…±åŒèœç³»
      const cuisineCount = {};
      analyzed.forEach(u => {
        u.profile.preferred_cuisines.forEach(c => {
          cuisineCount[c.name] = (cuisineCount[c.name] || 0) + 1;
        });
      });
      
      const threshold = analyzed.length * 0.5;
      const commonCuisines = Object.entries(cuisineCount)
        .filter(([_, count]) => count >= threshold)
        .map(([name]) => name);

      // è®¡ç®—å¹³å‡å£å‘³
      const avgTaste = {
        spicy: analyzed.reduce((sum, u) => sum + u.profile.taste_profile.spicy, 0) / analyzed.length,
        sweet: analyzed.reduce((sum, u) => sum + u.profile.taste_profile.sweet, 0) / analyzed.length,
        salty: analyzed.reduce((sum, u) => sum + u.profile.taste_profile.salty, 0) / analyzed.length,
        numbing: analyzed.reduce((sum, u) => sum + u.profile.taste_profile.numbing, 0) / analyzed.length,
      };

      groupResult.innerHTML = `
        <div class="bg-gradient-to-br from-orange-50 to-amber-50 rounded-xl p-6">
          <h3 class="text-lg font-medium text-gray-800 mb-4 flex items-center gap-2">
            <span class="text-2xl">ğŸ¯</span>
            ç¾¤ä½“åŒ¹é…ç»“æœ
            <span class="text-sm font-normal text-gray-500">(${analyzed.length} äºº)</span>
          </h3>
          
          <div class="mb-4">
            <p class="text-sm text-gray-600 mb-2">å…±åŒåå¥½èœç³»</p>
            ${commonCuisines.length ? `
              <div class="flex flex-wrap gap-2">
                ${commonCuisines.map(c => `
                  <span class="px-3 py-1.5 bg-white text-orange-700 text-sm font-medium rounded-lg shadow-sm">${c}</span>
                `).join('')}
              </div>
            ` : '<p class="text-sm text-gray-500 italic">æš‚æ— å…±åŒèœç³» ğŸ˜…</p>'}
          </div>
          
          <div class="mb-4">
            <p class="text-sm text-gray-600 mb-2">ç¾¤ä½“å¹³å‡å£å‘³</p>
            <div class="bg-white rounded-lg p-3 space-y-2">
              ${createTasteBar('è¾£', avgTaste.spicy, '#ef4444')}
              ${createTasteBar('éº»', avgTaste.numbing, '#a855f7')}
              ${createTasteBar('ç”œ', avgTaste.sweet, '#f97316')}
            </div>
          </div>
          
          <div class="bg-white rounded-lg p-4">
            <p class="text-sm font-medium text-gray-800 mb-2">ğŸ’¡ æ¨èç­–ç•¥</p>
            ${commonCuisines.length > 0 ? `
              <p class="text-sm text-gray-600">
                æ¨è <span class="font-medium text-orange-600">${commonCuisines[0]}</span> é¤å…
              </p>
              <p class="text-xs text-gray-500 mt-1">å¤§å¤šæ•°äººéƒ½å–œæ¬¢ ${commonCuisines[0]}ï¼ŒåŒ¹é…åº¦æœ€é«˜</p>
            ` : `
              <div class="space-y-2 text-sm text-gray-600">
                <p>å£å‘³å·®å¼‚è¾ƒå¤§ï¼Œå»ºè®®ï¼š</p>
                <ul class="space-y-1 text-xs text-gray-500 list-disc list-inside">
                  <li>é€‰æ‹©èåˆèœç³»é¤å…ï¼ˆåˆ›æ„ä¸­é¤ã€äºšæ´²èåˆèœï¼‰</li>
                  <li>é€‰æ‹©è‡ªåŠ©é¤å…ï¼Œå„è‡ªé€‰æ‹©å–œæ¬¢çš„é£Ÿç‰©</li>
                  <li>ç«é”…ï¼ˆä¸åŒé”…åº•+å„ç§é£Ÿæï¼Œå…¼å®¹æ‰€æœ‰äººï¼‰</li>
                </ul>
              </div>
            `}
          </div>
        </div>
      `;
    }

    // ============ ç¤ºä¾‹æ•°æ® ============
    function loadDemoData() {
      users = [
        { id: '1', name: 'å°æ˜', dishes: 'å®«ä¿é¸¡ä¸\néº»å©†è±†è…\næ°´ç…®é±¼\nå®«çˆ†é¸¡ä¸\nè¾£å­é¸¡\nå›é”…è‚‰\né…¸èœé±¼\næ¯›è¡€æ—º\nå£æ°´é¸¡\né±¼é¦™è‚‰ä¸', profile: null },
        { id: '2', name: 'å°çº¢', dishes: 'ç³–é†‹æ’éª¨\nçº¢çƒ§è‚‰\næ¸…è’¸é±¼\nç™½åˆ‡é¸¡\nè¥¿çº¢æŸ¿ç‚’è›‹\nå¯ä¹é¸¡ç¿…\nåœŸè±†ç‰›è…©\nåœ°ä¸‰é²œ\næœ¨é¡»è‚‰\nç‚’é’èœ', profile: null },
        { id: '3', name: 'å°æ', dishes: 'å¯¿å¸\nåˆºèº«\næ‹‰é¢\nå¤©å¦‡ç½—\nçƒ¤é³—é±¼\nå¯¿å–œçƒ§\nç‚¸é¸¡\nä¹Œå†¬é¢\nå’–å–±é¥­\nçŒªæ’é¥­', profile: null },
      ];
      userCounter = 3;
      renderUserCards();
    }

    // åˆå§‹åŒ–
    renderUserCards();
  </script>
</body>
</html>
